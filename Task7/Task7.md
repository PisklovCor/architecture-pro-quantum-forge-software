## Задание 7. Аналитика покрытия и качества базы знаний

В финальном задании проектной работы вы должны оценить **полноту и актуальность базы знаний**, выявить темы, по которым бот
не сможет дать ответы, и обоснованно **улучшить покрытие**. Это ключевой шаг, чтобы превратить RAG-бота из эксперимента в
полноценный рабочий инструмент.

RAG-система бесполезна, если:
- она не знает ответов на частые вопросы,
- база знаний неполная или устаревшая,
- нельзя понять, по каким темам бот «слеп».

В реальных продуктах эта проблема решается через аналитику логов запросов, автоматические тесты и покрытие «золотыми
вопросами» (golden set).

## Что нужно сделать
1. **Внесите искусственные пробелы в базу**
Удалите 2-3 ключевые сущности из вашей базы знаний. Например, упоминания планеты VoidCore, персонажа Xarn Velgor и
концепта Synth Flux. Так вы сможете протестировать, как ваш чат-бот себя ведёт при отсутствии нужной информации.

2. **Напишите скрипт логирования запросов**
Каждый запрос к боту должен сохраняться в лог с полями:
- текст запроса,
- timestamp,
- были ли найдены чанки,
- длина ответа,
- флаг «успешный ответ» (по длине, осмысленности или по ключевым словам),
- найденные источники.

Можно вести лог в CSV, JSONL или SQLite — любой формат, пригодный для анализа.

3. **Сформируйте «золотой набор» вопросов**
Подготовьте 10–15 вопросов, покрывающих разные аспекты вашей базы:
- 6–8 вопросов на известные темы (бот должен ответить),
- 3–5 вопросов на удалённые или отсутствующие (бот должен не ответить корректно).

4. **Проведите автоматическое тестирование**
Запустите скрипт, который:
- по очереди будет задавать вопросы из набора,
- сохранит результат в лог,
- оценит, был ли ответ корректным (например: ответ найден: да/нет
оценка полноты).

5. **Проанализируйте логи**
Выявите:
- По каким темам бот часто не отвечает.
- Где выдаёт нерелевантные источники.
- Где нужно расширить или переписать базу знаний.

6. Нарисуйте диаграмму
Постройте диаграмму последовательности (sequence diagram), которая покажет:
- Как обрабатывается запрос.
- Как происходит процесс оценки.
- Где может происходить сбой (например, пустой индекс, невалидный чанк, генерация ответа).

### Результат
По итогу задания у вас должно получиться:
- logs.jsonl или logs.csv с полями: запрос, результат, источники, длина, статус.
- golden_questions.txt с ожидаемыми ответами.
- Спроектированное автоматическое тестирование обновлённой версии индекса на наборе заранее подготовленных «золотых»
вопросов. Их вам нужно самостоятельно придумать на основе вашей базы.
- Скрипт evaluate.py или test_rag_bot.py — автоматическая проверка качества.
- Диаграмма на PlantUML или с помощью онлайн-сервисов для создания диаграмм и схем Draw.io или mermaid.

**Важно!** Пока, к сожалению, ещё не сложилось никаких лучших практик, на которые можно опереться, ведь сама тема всё ещё
довольно новая. Однако вот несколько референсов, на которые стоит ориентироваться.
- [Исследование по оценке RAG](https://arxiv.org/abs/2405.07437)
- [Подробное руководство по передовому опыту оценки RAG](https://qdrant.tech/blog/rag-evaluation-guide)
- [Как мы оцениваем точность ответов основанного на RAG AI-помощника](https://habr.com/ru/companies/alfastrah/articles/889042/)
- [Как оценивать ваш RAG-пайплайн и валидировать качество ответов LLM](https://habr.com/ru/articles/870174/)
- [Оцениваем RAG-пайплайны](https://habr.com/ru/articles/778166/)

Референс отчёта с выводами должен содержать:
- Какие темы плохо покрыты.
- Сколько «пробелов» выявлено.
- Рекомендации по улучшению базы знаний компании.
