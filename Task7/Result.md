# Результаты выполнения задания 7

## Выполненные задачи

### 1. Создание искусственных пробелов в базе знаний

Реализован скрипт `remove_entities.py`, который удаляет из векторного индекса информацию о следующих сущностях:
- **Yoda** (Йода) - ключевой персонаж
- **Death Star** (Звезда Смерти) - важная технология
- **Darth Vader** (Дарт Вейдер) - ключевой персонаж

Это позволяет протестировать поведение бота при отсутствии информации в базе знаний.

### 2. Система логирования запросов

Создан модуль `logger.py`, который логирует каждый запрос к RAG-боту в формате JSONL со следующими полями:
- `timestamp` - время запроса
- `query` - текст запроса
- `answer` - ответ бота
- `answer_length` - длина ответа
- `chunks_found` - были ли найдены чанки
- `chunks_count` - количество найденных чанков
- `sources` - найденные источники с метаданными
- `success` - флаг успешности ответа
- `reasoning` - объяснение процесса поиска

### 3. Золотой набор вопросов

Сформирован файл `golden_questions.txt` с 13 вопросами:
- **8 вопросов на известные темы** - бот должен дать корректный ответ
  - Персонажи: Люк Скайуокер, Хан Соло, Принцесса Лея
  - Концепты: Сила, Джедаи
  - Технологии: Световой меч, Millennium Falcon
  - Планеты: Татуин

- **5 вопросов на удаленные темы** - бот не должен ответить корректно
  - Yoda (удален)
  - Death Star (удалена)
  - Darth Vader (удален)
  - Void Core (отсутствует)
  - Xarn Velgor (отсутствует)

### 4. Автоматическое тестирование

Реализован скрипт `evaluate.py`, который:
- Загружает золотой набор вопросов
- Выполняет каждый запрос через RAG-движок
- Оценивает корректность ответов на основе критериев:
  - Наличие найденных чанков
  - Отсутствие индикаторов неуспеха в ответе
  - Достаточная длина ответа
  - Соответствие ожидаемому поведению (должен/не должен ответить)
- Сохраняет результаты в `evaluation_results.json`
- Логирует все запросы в `logs.jsonl`

### 5. Анализ логов

Создан скрипт `analyze_logs.py`, который:
- Анализирует все записи в логе
- Вычисляет статистику:
  - Общее количество запросов
  - Процент успешных/неуспешных ответов
  - Средняя длина ответов
- Выявляет пробелы по категориям:
  - Персонажи
  - Концепты/Технологии
  - Планеты
- Определяет проблемы с релевантностью источников
- Генерирует отчет с рекомендациями по улучшению

### 6. Диаграмма последовательности

Создана диаграмма `sequence_diagram.puml` (PlantUML), которая показывает:
- Процесс обработки запроса от пользователя до ответа
- Взаимодействие компонентов:
  - Скрипт тестирования
  - RAG Engine
  - Logger
  - Embedding Model
  - ChromaDB
  - YandexGPT (LLM)
  - Анализатор логов
- Точки возможных сбоев:
  - Пустой индекс
  - Невалидные чанки
  - Ошибки эмбеддингов
  - Ошибки LLM
  - Нерелевантные чанки

## Структура файлов

```
Task7/
├── remove_entities.py      # Удаление сущностей из индекса
├── logger.py               # Модуль логирования
├── golden_questions.txt    # Золотой набор вопросов
├── evaluate.py            # Автоматическое тестирование
├── analyze_logs.py        # Анализ логов
├── sequence_diagram.puml  # Диаграмма последовательности
├── requirements.txt       # Зависимости
├── README.md              # Документация
└── Result.md              # Этот файл
```

## Использование

### Шаг 1: Создание пробелов в базе знаний
```bash
cd Task7
python remove_entities.py
```

### Шаг 2: Запуск тестирования
```bash
python evaluate.py
```

### Шаг 3: Анализ результатов
```bash
python analyze_logs.py
```

## Ожидаемые результаты

После выполнения всех шагов будут созданы файлы:
- `logs.jsonl` - Логи всех запросов
- `evaluation_results.json` - Результаты тестирования
- `analysis_report.txt` - Отчет с выводами и рекомендациями
- `removal_info.json` - Информация об удаленных сущностях

## Метрики качества

Система оценивает качество ответов по следующим критериям:

1. **Наличие релевантных чанков** - найдены ли подходящие фрагменты в базе знаний
2. **Отсутствие индикаторов неуспеха** - нет ли в ответе фраз типа "я не знаю"
3. **Достаточная длина ответа** - ответ содержит достаточно информации
4. **Соответствие ожиданиям** - для известных тем должен быть ответ, для удаленных - признание отсутствия информации

## Выводы и рекомендации

Система позволяет:
- Выявить пробелы в базе знаний по категориям
- Определить темы, требующие расширения
- Оценить качество поиска и релевантность источников
- Получить конкретные рекомендации по улучшению

Отчет `analysis_report.txt` содержит:
- Статистику успешности ответов
- Список тем с высоким процентом неуспешных запросов
- Примеры проблемных запросов
- Конкретные рекомендации по улучшению базы знаний

