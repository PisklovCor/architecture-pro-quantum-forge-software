# Инструкция по созданию базы знаний

Этот набор скриптов создает уникальную базу знаний из вселенной Star Wars, заменяя все ключевые термины на вымышленные названия. Это необходимо для проверки работы RAG-системы, так как LLM не сможет использовать знания из обучения.

## Структура проекта

```
Task2/
├── requirements.txt          # Зависимости Python
├── terms_map.json           # Словарь замен терминов
├── 01_download_pages.py     # Скрипт скачивания HTML-страниц
├── 02_clean_texts.py        # Скрипт очистки HTML и извлечения текста
├── 03_replace_terms.py      # Скрипт замены терминов
├── main.py                  # Главный скрипт (запускает все этапы)
├── README_INSTRUCTIONS.md   # Эта инструкция
├── raw_html/                # Папка с исходными HTML-файлами (создается автоматически)
├── cleaned_texts/           # Папка с очищенными текстами (создается автоматически)
└── knowledge_base/          # Финальная база знаний (создается автоматически)
```

## Установка зависимостей

Перед запуском скриптов установите необходимые библиотеки:

```bash

pip install -r requirements.txt
```

## Варианты запуска

### Вариант 1: Автоматический запуск всех этапов (рекомендуется)

Запустите главный скрипт, который выполнит все этапы последовательно:

```bash

python main.py
```

Этот скрипт автоматически:
1. Скачает HTML-страницы с Star Wars Fandom
2. Очистит тексты от HTML-разметки
3. Заменит все термины согласно словарю
4. Сохранит результаты в папку `knowledge_base/`

### Вариант 2: Пошаговый запуск

Если нужно выполнить этапы по отдельности:

#### Шаг 1: Скачивание HTML-страниц

```bash

python 01_download_pages.py
```

**Что делает:**
- Скачивает 40+ HTML-страниц с starwars.fandom.com
- Сохраняет их в папку `raw_html/`
- Добавляет задержку между запросами, чтобы не перегружать сервер

**Результат:** Папка `raw_html/` с HTML-файлами

#### Шаг 2: Очистка текстов

```bash
python 02_clean_texts.py
```

**Что делает:**
- Извлекает чистый текст из HTML-файлов
- Удаляет навигацию, скрипты, стили и другие ненужные элементы
- Очищает от лишних пробелов и переносов строк
- Сохраняет по одному текстовому файлу на каждую сущность

**Результат:** Папка `cleaned_texts/` с текстовыми файлами (.txt)

#### Шаг 3: Замена терминов

```bash
python 03_replace_terms.py
```

**Что делает:**
- Загружает словарь замен из `terms_map.json`
- Заменяет все упоминания оригинальных терминов на вымышленные
- Использует регулярные выражения для точного совпадения
- Сохраняет финальные документы в `knowledge_base/`
- Копирует `terms_map.json` в папку `knowledge_base/`

**Результат:** Папка `knowledge_base/` с финальными документами и словарем замен

## Результаты

После выполнения всех скриптов вы получите:

1. **Папка `knowledge_base/`** содержит:
   - 30+ текстовых файлов (.txt) с замененными терминами
   - Файл `terms_map.json` со словарем всех замен

2. **Примеры замен:**
   - "Darth Vader" → "Xarn Velgor"
   - "Death Star" → "Void Core"
   - "The Force" → "Synth Flux"
   - "Jedi" → "Flux Wardens"
   - И многие другие...

## Настройка словаря замен

Если нужно изменить или добавить замены, отредактируйте файл `terms_map.json`:

```json
{
  "replacements": {
    "Оригинальный термин": "Вымышленное название",
    ...
  }
}
```

**Важно:** После изменения словаря нужно перезапустить только скрипт `03_replace_terms.py`.

## Возможные проблемы и решения

### Проблема: Ошибка при скачивании страниц

**Причина:** Проблемы с сетью или сайт недоступен

**Решение:**
- Проверьте интернет-соединение
- Увеличьте задержку `DELAY` в `01_download_pages.py`
- Попробуйте запустить скрипт позже

### Проблема: Не все термины заменяются

**Причина:** Термин написан с другим регистром или в составе другого слова

**Решение:**
- Скрипт использует `re.IGNORECASE`, поэтому регистр не важен
- Проверьте, что термин есть в `terms_map.json`
- Убедитесь, что термин не является частью другого слова

### Проблема: Тексты слишком короткие

**Причина:** HTML-страница не содержит достаточно контента

**Решение:**
- Проверьте файлы в `raw_html/` - возможно, страница не скачалась полностью
- Попробуйте скачать страницу вручную и проверить её содержимое

## Описание словаря замен

**Источник:** Вселенная Star Wars (starwars.fandom.com)

**Принцип замены:**
- Персонажи: заменены на вымышленные имена, сохраняющие стиль оригинала
- Технологии: заменены на фантастические названия (например, "Lightsaber" → "Flux Blade")
- Организации: заменены на вымышленные названия (например, "Jedi" → "Flux Wardens")
- Планеты: заменены на вымышленные названия (например, "Tatooine" → "Zephyr Prime")
- События: заменены с сохранением контекста

**Цель:** Создать базу знаний, которую LLM не может "угадать" из своих обучающих данных, но которая сохраняет логику и структуру оригинального мира.

## Дополнительные возможности

### Добавление новых страниц

Чтобы добавить новые страницы для скачивания, отредактируйте список `PAGES` в файле `01_download_pages.py`:

```python
PAGES = [
    "Darth_Vader",
    "Luke_Skywalker",
    # ... добавьте новые страницы здесь
    "Новое_название_страницы"
]
```

### Изменение формата выходных файлов

По умолчанию файлы сохраняются в формате `.txt`. Чтобы изменить формат на `.md`, отредактируйте функции сохранения в скриптах `02_clean_texts.py` и `03_replace_terms.py`.

## Проверка результатов

После выполнения всех скриптов проверьте:

1. Количество файлов в `knowledge_base/` должно быть 30+
2. Файл `knowledge_base/terms_map.json` должен содержать словарь замен
3. Откройте несколько файлов и убедитесь, что термины заменены корректно
4. Проверьте, что тексты читаемы и логичны

---

**Готово!** Теперь у вас есть уникальная база знаний для тестирования RAG-системы.

